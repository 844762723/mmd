<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mmt.dao.AgencyDao">
    <insert id="saveAgencyInfo" parameterType="agency">
        insert INTO agency(anick, alogin_no, alogin_password, alogin_password_source, ano, aname, aprefix, alinkname, alinkphone,
        alinkweixin, alinkqq, legal, male, address, agency_city, business, contract, otherdata,
        memo, crtuser, crtdate, recsts)
        VALUES (#{anick}, #{alogin_no}, #{alogin_password}, #{alogin_password_source}, #{ano}, #{aname}, #{alinkname}, #{alinkphone},
        #{alinkweixin}, #{alinkqq}, #{legal}, #{male}, #{address}, #{agency_city}, #{business}, #{contract}, #{otherdata}, #{memo},
        #{crtuser}, now(), '1')
    </insert>

    <update id="updAgencyInfo" parameterType="agency">
        update agency set anick = #{anick}, alogin_no = #{alogin_no}, alogin_password = #{alogin_password},
         alogin_password_source = #{alogin_password_source}, ano = #{ano}, aname = #{aname}, aprefix = #{aprefix}, alinkname = #{alinkname},
         alinkphone = #{alinkphone}, alinkweixin = #{alinkweixin}, alinkqq = #{alinkqq}, legal = #{legal}, male = #{male},
         address = #{address}, agency_city = #{agency_city}, business = #{business}, contract = #{contract}, otherdata = #{otherdata},
         memo = #{memo}, upddate = now(), upduser = #{upduser} where aid = #{aid}
    </update>

    <update id="delAgency">
        update agency set recsts = 'D' where aid in <foreach collection="ids" item="id" separator="," open="(" close=")">#{id}</foreach>
    </update>

    <select id="getAgencyList" resultType="agency" parameterType="agency">
        SELECT *, (select city from bs_city where id = agency_city) agency_cityname from agency
        <where>
            recsts = '1'
            <if test="alinkphone != null and alinkphone != ''">
              and alinkphone = #{alinkphone}
            </if>
            <if test="alinkname != null and alinkname != ''">
                and alinkname like concat('%', #{alinkphone}, '%')
            </if>
        </where>

    </select>
    <select id="getAgencyDetail" resultType="agency">
        SELECT * from agency where aid = #{id} and recsts = '1'
    </select>
    <select id="getAgencyWithLoginNo" resultType="int" parameterType="agency">
        SELECT count(*) from agency where alogin_no = #{alogin_no}
        <if test="aid != null and aid != ''">
            and aid != #{aid}
        </if>
    </select>
</mapper>